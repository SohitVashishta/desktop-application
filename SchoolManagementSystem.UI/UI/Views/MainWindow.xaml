<Window x:Class="SchoolManagementSystem.UI.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="School Management System"
        Height="650"
        Width="1100"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource MaterialDesignPaper}">

    <!-- ================= RESOURCES ================= -->
    <Window.Resources>

        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>

        <!-- MAIN MENU BUTTON -->
        <Style x:Key="MenuButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource MaterialDesignFlatButton}">
            <Setter Property="Height" Value="40"/>
            <Setter Property="Margin" Value="6,3"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="ContentTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Tag}"
                                                     Width="20"
                                                     Height="20"
                                                     Margin="0,0,10,0"
                                                     Foreground="White"/>
                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- SUB MENU BUTTON -->
        <Style x:Key="SubMenuButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource MaterialDesignFlatButton}">
            <Setter Property="Height" Value="34"/>
            <Setter Property="Margin" Value="32,2,6,2"/>
            <Setter Property="Foreground" Value="#E5E7EB"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="ContentTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Tag}"
                                                     Width="16"
                                                     Height="16"
                                                     Margin="0,0,8,0"
                                                     Foreground="#9CA3AF"/>
                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- SIDEBAR EXPANDER -->
        <Style x:Key="SidebarExpanderStyle"
               TargetType="Expander">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="4,2"/>
            <Setter Property="HeaderTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="{Binding RelativeSource={RelativeSource AncestorType=Expander}, Path=Tag}"
                                                     Width="20"
                                                     Height="20"
                                                     Margin="0,0,10,0"
                                                     Foreground="White"/>
                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <!-- ================= LAYOUT ================= -->
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="230"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ================= SIDEBAR ================= -->
        <Border Grid.Column="0" Background="#1F2937">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- BRAND -->
                <StackPanel Grid.Row="0" Margin="16">
                    <TextBlock Text="SMS" FontSize="20" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="{Binding Username}" FontSize="12" Foreground="#9CA3AF"/>
                </StackPanel>

                <!-- MENU -->
                <ScrollViewer Grid.Row="1">
                    <StackPanel>

                        <Button Content="Dashboard"
                                Tag="ViewDashboard"
                                Style="{StaticResource MenuButtonStyle}" Click="Dashboard_Click"/>

                        <Expander Header="User &amp; Role Management"
                                  Tag="AccountGroup"
                                  Style="{StaticResource SidebarExpanderStyle}"  
                                  Visibility="{Binding IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <Button Content="Manage Users" Tag="AccountMultiple" Style="{StaticResource SubMenuButtonStyle}" Click="ManageUsers_Click"/>
                                <Button Content="Assign Roles &amp; Permissions" Tag="ShieldAccount" Style="{StaticResource SubMenuButtonStyle}" Click="AssignRoles_Click"/>
                                <Button Content="Reset Passwords" Tag="LockReset" Style="{StaticResource SubMenuButtonStyle}" Click="ResetPasswords_Click"/>
                                <Button Content="Portal Access Control" Tag="ShieldKey" Style="{StaticResource SubMenuButtonStyle}" Click="PortalAccess_Click"/>
                            </StackPanel>
                        </Expander>

                        <Expander Header="Student Management"
                                  Tag="School"
                                  Style="{StaticResource SidebarExpanderStyle}"  
                                  Visibility="{Binding IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <Button Content="Student Profiles" Tag="AccountSchool" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Class / Section Assignment" Tag="AccountGroupOutline" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Academic Year Mapping" Tag="Calendar" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Enrollment &amp; Transfers" Tag="AccountPlus" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Document Uploads" Tag="FileDocument" Style="{StaticResource SubMenuButtonStyle}"/>
                            </StackPanel>
                        </Expander>

                        <Expander Header="Attendance Management"
                                  Tag="CalendarCheck"
                                  Style="{StaticResource SidebarExpanderStyle}"  
                                  Visibility="{Binding IsAdmin, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <Button Content="Student Attendance" Tag="ClipboardCheck" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Teacher Attendance" Tag="AccountTie" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Staff Attendance" Tag="AccountHardHat" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Attendance Reports" Tag="FileChart" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Absentee Alerts" Tag="Alert" Style="{StaticResource SubMenuButtonStyle}"/>
                            </StackPanel>
                        </Expander>

                        <Expander Header="Teacher"
                                  Tag="AccountTie"
                                  Style="{StaticResource SidebarExpanderStyle}"  
                                  Visibility="{Binding IsTeacher, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <Button Content="My Students" Tag="AccountMultiple" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Mark Attendance" Tag="ClipboardCheck" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Enter Marks" Tag="Pen" Style="{StaticResource SubMenuButtonStyle}"/>
                            </StackPanel>
                        </Expander>

                        <Expander Header="My Profile"
                                  Tag="Account"
                                  Style="{StaticResource SidebarExpanderStyle}" 
                                  Visibility="{Binding IsStudent, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <Button Content="View Profile" Tag="AccountCircle" Style="{StaticResource SubMenuButtonStyle}"/>
                                <Button Content="Update Profile" Tag="AccountEdit" Style="{StaticResource SubMenuButtonStyle}"/>
                            </StackPanel>
                        </Expander>

                    </StackPanel>
                </ScrollViewer>

                <!-- LOGOUT -->
                <Button Grid.Row="2"
                        Content="Logout"
                        Tag="Logout"
                        Style="{StaticResource MenuButtonStyle}"
                        Background="#DC2626"
                        Foreground="White"
                        Click="Logout_Click"
                        />
            </Grid>
        </Border>

        <!-- ================= CONTENT ================= -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="48"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <Border Background="White"
                    BorderBrush="#E5E7EB"
                    BorderThickness="0,0,0,1">
                <TextBlock Text="{Binding PageTitle}"
                           Margin="12"
                           FontWeight="SemiBold"/>
            </Border>

            <materialDesign:Card Grid.Row="1"
                                  Margin="16"
                                  Padding="16"
                                  materialDesign:ElevationAssist.Elevation="Dp6">
                <ContentControl x:Name="MainContent"/>
            </materialDesign:Card>
        </Grid>
    </Grid>
</Window>
