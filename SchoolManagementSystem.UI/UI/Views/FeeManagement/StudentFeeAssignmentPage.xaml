<UserControl x:Class="SchoolManagementSystem.UI.UI.Views.FeeManagement.StudentFeeAssignmentPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Page Header -->
            <RowDefinition Height="Auto"/>
            <!-- Filter Bar -->
            <RowDefinition Height="*"/>
            <!-- Content -->
        </Grid.RowDefinitions>

        <!-- ================= PAGE HEADER ================= -->
        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="Student Fee Assignment"
                       FontSize="20"
                       FontWeight="SemiBold"/>

            <TextBlock Text="Assign or update fees for individual students or whole class"
                       FontSize="12"
                       Foreground="Gray"/>
        </StackPanel>

        <!-- ================= FILTER BAR ================= -->
        <Border Grid.Row="1"
                Padding="12"
                CornerRadius="6"
                Background="{DynamicResource MaterialDesignPaper}"
                md:ShadowAssist.ShadowDepth="Depth1">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <!-- Academic Year -->
                    <ColumnDefinition Width="2*"/>
                    <!-- Class -->
                    <ColumnDefinition Width="2*"/>
                    <!-- Fee Type -->
                    <ColumnDefinition Width="3*"/>
                    <!-- Student -->
                    <ColumnDefinition Width="Auto"/>
                    <!-- Buttons -->
                </Grid.ColumnDefinitions>

                <!-- Academic Year -->
                <ComboBox Grid.Column="0"
              ItemsSource="{Binding AcademicYears}"
              SelectedItem="{Binding SelectedAcademicYear, Mode=TwoWay}"
              DisplayMemberPath="YearName"
              md:HintAssist.Hint="Academic Year"/>

                <!-- Class -->
                <ComboBox Grid.Column="1"
              Margin="8,0,0,0"
              ItemsSource="{Binding Classes}"
              SelectedItem="{Binding SelectedClass, Mode=TwoWay}"
              DisplayMemberPath="ClassName"
              md:HintAssist.Hint="Class"/>

                <!-- Fee Type -->
                <ComboBox Grid.Column="2"
              Margin="8,0,0,0"
              ItemsSource="{Binding FeeTypes}"
              SelectedItem="{Binding SelectedFeeType, Mode=TwoWay}"
              md:HintAssist.Hint="Fee Type"/>

                <!-- Student -->
                <ComboBox Grid.Column="3"
          Margin="8,0,0,0"
          ItemsSource="{Binding Students}"
          SelectedItem="{Binding SelectedStudent, Mode=TwoWay}"
          DisplayMemberPath="StudentName"
          IsEnabled="{Binding IsClassSelected}"
          md:HintAssist.Hint="Student (Optional)"/>


                <!-- Buttons -->
                <Grid Grid.Column="4" Margin="8,0,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                        <ColumnDefinition/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0"
            Content="Load Fees"
            Margin="0,0,8,0"
            Command="{Binding LoadFeeStructureCommand}"
            IsEnabled="{Binding CanLoadFees}"
            Style="{StaticResource MaterialDesignOutlinedButton}"/>

                    <Button Grid.Column="1"
            Content="Bulk Assign"
            Margin="0,0,8,0"
            Command="{Binding BulkAssignCommand}"
            Style="{StaticResource MaterialDesignRaisedButton}"/>

                    <Button Grid.Column="2"
            Content="Clear"
            Command="{Binding ClearFilterCommand}"
            Style="{StaticResource MaterialDesignFlatButton}"/>
                </Grid>

            </Grid>

        </Border>

        <!-- ================= MAIN CONTENT ================= -->
        <Grid Grid.Row="2" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- ================= LEFT : FEE GRID ================= -->
            <Border Padding="12"
                    Margin="0,0,16,0"
                    CornerRadius="6"
                    Background="{DynamicResource MaterialDesignPaper}"
                    md:ShadowAssist.ShadowDepth="Depth1">

                <StackPanel>

                    <TextBlock Text="Fee Details"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12"/>

                    <DataGrid ItemsSource="{Binding FeeDetails}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              RowHeight="36"
                              IsReadOnly="{Binding IsFeeLocked}"
                              HeadersVisibility="Column"
                              GridLinesVisibility="None">

                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Fee Head"
                                                Binding="{Binding FeeHeadName}"
                                                Width="*"/>

                            <DataGridTextColumn Header="Amount"
                                                Binding="{Binding FeeAmount}"
                                                Width="120"/>

                            <DataGridTextColumn Header="Discount"
                                                Binding="{Binding DiscountAmount, Mode=TwoWay}"
                                                Width="120"/>

                            <DataGridTextColumn Header="Net Amount"
                                                Binding="{Binding NetAmount}"
                                                Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>

                </StackPanel>
            </Border>

            <!-- ================= RIGHT : SUMMARY & ACTION ================= -->
            <Border Grid.Column="1"
                    Padding="12"
                    CornerRadius="6"
                    Background="{DynamicResource MaterialDesignPaper}"
                    md:ShadowAssist.ShadowDepth="Depth1">

                <StackPanel>

                    <TextBlock Text="Assignment Summary"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12"/>

                    <!-- Status -->
                    <Border Padding="8"
                            Margin="0,0,0,12"
                            CornerRadius="4"
                            Background="#FFF3F4F6">
                        <TextBlock Text="{Binding AssignmentStatus}"
                                   FontWeight="SemiBold"/>
                    </Border>

                    <!-- Totals -->
                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Total Net Fees"
                                   Foreground="Gray"/>

                        <TextBlock Text="{Binding NetFees, StringFormat=₹ {0}}"
                                   FontSize="20"
                                   FontWeight="Bold"/>
                    </StackPanel>

                    <!-- Due Date -->
                    <DatePicker SelectedDate="{Binding DueDate}"
                                md:HintAssist.Hint="Due Date"
                                IsEnabled="{Binding IsFeeLocked, Converter={StaticResource InverseBoolConverter}}"/>

                    <!-- Actions -->
                    <Button Margin="0,16,0,0"
                            Content="{Binding AssignButtonText}"
                            Command="{Binding AssignFeeCommand}"
                            IsEnabled="{Binding IsFeeLocked, Converter={StaticResource InverseBoolConverter}}"
                            Style="{StaticResource MaterialDesignRaisedButton}"/>

                </StackPanel>
            </Border>

        </Grid>
    </Grid>
</UserControl>
