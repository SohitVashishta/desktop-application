<UserControl x:Class="SchoolManagementSystem.UI.UI.Views.Admin.ManageUsersPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:SchoolManagementSystem.UI.UI.ViewModels.Admin"
             xmlns:ui="clr-namespace:SchoolManagementSystem.UI.UI.Helpers">

    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <Border Padding="15"
                Background="White"
                CornerRadius="10"
                Margin="0,0,0,15">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Text="User Management"
                           FontSize="22"
                           FontWeight="SemiBold"/>

                <Button Grid.Column="1"
                        Content="+ Add User"
                        Width="130"
                        Height="36"
                        Background="#4F46E5"
                        Foreground="White"
                        Command="{Binding AddUserCommand}"/>
            </Grid>
        </Border>

        <!-- MAIN CONTENT -->
        <Border Grid.Row="1"
                Padding="15"
                Background="White"
                CornerRadius="10">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- FILTER BAR -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">

                    <TextBox Width="250"
                             Height="38"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource PlaceholderTextBoxStyle}"
                             ui:PlaceholderHelper.Placeholder="Search user..." />

                    <ComboBox Width="160"
                              Height="32"
                              Margin="10,0,0,0"
                              ItemsSource="{Binding Roles}"
                              SelectedItem="{Binding SelectedRole}"
                              Style="{StaticResource PlaceholderComboBoxStyle}"
                              ui:PlaceholderHelper.Placeholder="All Roles..." />
                </StackPanel>

                <!-- USERS TABLE -->
                <DataGrid Grid.Row="1"
                          ItemsSource="{Binding FilteredUsers}"
                          AutoGenerateColumns="False"
                          HeadersVisibility="Column"
                          CanUserAddRows="False"
                          IsReadOnly="True"
                          RowHeight="42">

                    <DataGrid.Columns>

                        <DataGridTextColumn Header="Username"
                                            Binding="{Binding Username}"
                                            Width="*"/>

                        <DataGridTextColumn Header="Email"
                                            Binding="{Binding Email}"
                                            Width="*"/>

                        <DataGridTextColumn Header="Role"
                                            Binding="{Binding Role}"
                                            Width="140"/>

                        <DataGridTemplateColumn Header="Status" Width="120">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding StatusText}"
                                               Foreground="{Binding StatusColor}"
                                               FontWeight="SemiBold"
                                               HorizontalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <DataGridTemplateColumn Header="Actions" Width="200">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal"
                                                HorizontalAlignment="Center">

                                        <Button Content="Edit"
                                                Width="70"
                                                Margin="0,0,6,0"
                                                Command="{Binding DataContext.EditUserCommand,
                                                  RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"/>

                                        <Button Content="{Binding ToggleText}"
                                                Width="90"
                                                Command="{Binding DataContext.ToggleStatusCommand,
                                                  RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}"/>

                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </Border>
    </Grid>
</UserControl>
