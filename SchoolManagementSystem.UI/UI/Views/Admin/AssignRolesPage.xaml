<UserControl
    x:Class="SchoolManagementSystem.UI.UI.Views.Admin.AssignRolesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:helpers="clr-namespace:SchoolManagementSystem.UI.UI.Helpers">

    <!-- ================= RESOURCES ================= -->
    <UserControl.Resources>
        <helpers:FirstLetterConverter x:Key="FirstLetterConverter"/>
        <helpers:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>

    <!-- ================= ROOT ================= -->
    <Grid Margin="16">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ================================================= -->
        <!-- LEFT : USERS LIST -->
        <!-- ================================================= -->
        <Border Background="White"
                Padding="12"
                BorderBrush="#E5E7EB"
                BorderThickness="1"
                CornerRadius="8">

            <StackPanel>

                <!-- SEARCH -->
                <TextBox Height="40"
                         FontSize="13"
                         Padding="12,8"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         materialDesign:HintAssist.Hint="Search user"
                         Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>

                <!-- USERS + EMPTY STATE -->
                <Grid Margin="0,12,0,0">

                    <!-- USERS LIST -->
                    <ListView ItemsSource="{Binding FilteredUsers}"
                              SelectedItem="{Binding SelectedUser, Mode=TwoWay}"
                              BorderThickness="0">

                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal"
                                            Margin="0,6"
                                            VerticalAlignment="Center">

                                    <!-- AVATAR -->
                                    <Border Width="32"
                                            Height="32"
                                            CornerRadius="16"
                                            Background="#E0E7FF"
                                            VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Username,
                                                Converter={StaticResource FirstLetterConverter}}"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   FontWeight="SemiBold"
                                                   FontSize="14"
                                                   Foreground="#1E3A8A"/>
                                    </Border>

                                    <!-- INFO -->
                                    <StackPanel Margin="12,0">
                                        <TextBlock Text="{Binding Username}"
                                                   FontSize="13"
                                                   FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Email}"
                                                   FontSize="11"
                                                   Foreground="#6B7280"/>
                                    </StackPanel>

                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>

                    </ListView>

                    <!-- EMPTY STATE -->
                    <TextBlock Text="No users found"
                               Foreground="#9CA3AF"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Visibility="{Binding IsUserListEmpty,
                                    Converter={StaticResource BoolToVisibilityConverter}}"/>
                </Grid>

            </StackPanel>
        </Border>

        <!-- ================================================= -->
        <!-- RIGHT : ROLE & ACCESS -->
        <!-- ================================================= -->
        <Border Grid.Column="1"
                Margin="12,0,0,0"
                Background="White"
                Padding="16"
                BorderBrush="#E5E7EB"
                BorderThickness="1"
                CornerRadius="8">

            <StackPanel>

                <TextBlock Text="Access &amp; Permissions"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Margin="0,0,0,16"/>

                <!-- ROLE -->
                <ComboBox Height="40"
                          FontSize="13"
                          Padding="12,8"
                          Style="{StaticResource MaterialDesignOutlinedComboBox}"
                          ItemsSource="{Binding Roles}"
                          SelectedItem="{Binding SelectedUser.Role, Mode=TwoWay}"
                          IsEnabled="{Binding SelectedUser,
                                      Converter={StaticResource NullToBoolConverter}}"
                          materialDesign:HintAssist.Hint="Role"/>

                <!-- PORTAL ACCESS -->
                <TextBlock Text="Portal Access"
                           FontSize="13"
                           FontWeight="SemiBold"
                           Margin="0,16,0,8"/>

                <ToggleButton Style="{StaticResource MaterialDesignSwitchToggleButton}"
                              Width="44"
                              Height="22"
                              IsChecked="{Binding SelectedUser.IsActive}"
                              IsEnabled="{Binding SelectedUser,
                                          Converter={StaticResource NullToBoolConverter}}"/>

                <!-- SAVE -->
                <Button Height="40"
                        FontSize="13"
                        Margin="0,24,0,0"
                        Style="{StaticResource MaterialDesignRaisedButton}"
                        Background="#2563EB"
                        Foreground="White"
                        Command="{Binding SaveAccessCommand}">
                    Save Changes
                </Button>

            </StackPanel>
        </Border>

        <!-- ================================================= -->
        <!-- SNACKBAR (GLOBAL) -->
        <!-- ================================================= -->
        <materialDesign:Snackbar
            Grid.ColumnSpan="2"
            MessageQueue="{Binding SnackbarMessageQueue}"
            VerticalAlignment="Bottom"
            HorizontalAlignment="Right"
            Margin="16"/>
    </Grid>
</UserControl>
