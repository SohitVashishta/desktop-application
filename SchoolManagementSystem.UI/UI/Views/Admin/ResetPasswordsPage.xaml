<UserControl
    x:Class="SchoolManagementSystem.UI.UI.Views.Admin.ResetPasswordsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:helpers="clr-namespace:SchoolManagementSystem.UI.UI.Helpers">

    <UserControl.Resources>
        <helpers:FirstLetterConverter x:Key="FirstLetterConverter"/>
        <helpers:NullToBoolConverter x:Key="NullToBoolConverter"/>
        <helpers:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </UserControl.Resources>

    <materialDesign:DialogHost IsOpen="{Binding IsResetDialogOpen}">

        <!-- ================= MAIN ================= -->
        <Grid Margin="16">

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- ================= LEFT : USERS ================= -->
            <Border Background="White"
                    Padding="12"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1"
                    CornerRadius="8">

                <StackPanel>

                    <TextBox Height="40"
                             Padding="12,8"
                             FontSize="13"
                             Style="{StaticResource MaterialDesignOutlinedTextBox}"
                             materialDesign:HintAssist.Hint="Search user"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"/>

                    <ListView Margin="0,12,0,0"
                              ItemsSource="{Binding FilteredUsers}"
                              SelectedItem="{Binding SelectedUser}"
                              BorderThickness="0">

                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,6">

                                    <Border Width="32"
                                            Height="32"
                                            CornerRadius="16"
                                            Background="#E0E7FF">
                                        <TextBlock Text="{Binding Username,
                                            Converter={StaticResource FirstLetterConverter}}"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   FontWeight="SemiBold"
                                                   Foreground="#1E3A8A"/>
                                    </Border>

                                    <StackPanel Margin="12,0">
                                        <TextBlock Text="{Binding Username}"
                                                   FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Email}"
                                                   FontSize="11"
                                                   Foreground="#6B7280"/>
                                    </StackPanel>

                                </StackPanel>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>

                    <TextBlock Text="No users found"
                               Foreground="#9CA3AF"
                               HorizontalAlignment="Center"
                               Margin="0,16,0,0"
                               Visibility="{Binding IsUserListEmpty,
                                   Converter={StaticResource BoolToVisibilityConverter}}"/>

                </StackPanel>
            </Border>

            <!-- ================= RIGHT : SECURITY ================= -->
            <Border Grid.Column="1"
                    Margin="12,0,0,0"
                    Background="White"
                    Padding="16"
                    BorderBrush="#E5E7EB"
                    BorderThickness="1"
                    CornerRadius="8">

                <StackPanel>

                    <TextBlock Text="Security Actions"
                               FontSize="14"
                               FontWeight="SemiBold"
                               Margin="0,0,0,16"/>

                    <StackPanel Visibility="{Binding SelectedUser,
                        Converter={StaticResource NullToBoolConverter}}">

                        <TextBlock Text="{Binding SelectedUser.Username}"
                                   FontWeight="SemiBold"/>

                        <TextBlock Text="{Binding SelectedUser.Email}"
                                   FontSize="11"
                                   Foreground="#6B7280"
                                   Margin="0,0,0,16"/>

                        <Button Height="36"
                                Style="{StaticResource MaterialDesignFlatButton}"
                                Foreground="#DC2626"
                                Command="{Binding OpenResetDialogCommand}">
                            Reset Password
                        </Button>

                    </StackPanel>

                </StackPanel>
            </Border>

            <!-- ================= SNACKBAR ================= -->
            <materialDesign:Snackbar
                Grid.ColumnSpan="2"
                MessageQueue="{Binding SnackbarMessageQueue}"
                VerticalAlignment="Bottom"
                HorizontalAlignment="Right"
                Margin="16"/>

        </Grid>

        <!-- ================= RESET CONFIRM DIALOG ================= -->
        <materialDesign:DialogHost.DialogContent>
            <materialDesign:Card Padding="24" Width="360">

                <StackPanel>

                    <TextBlock Text="Reset password?"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Foreground="#DC2626"/>

                    <TextBlock Margin="0,12,0,0"
                               TextWrapping="Wrap">
                        This will immediately invalidate the current password
                        and force the user to set a new one.
                    </TextBlock>

                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right"
                                Margin="0,24,0,0">

                        <Button Style="{StaticResource MaterialDesignFlatButton}"
                                Command="{Binding CancelResetCommand}">
                            Cancel
                        </Button>

                        <Button Margin="12,0,0,0"
                                Style="{StaticResource MaterialDesignRaisedButton}"
                                Background="#DC2626"
                                Foreground="White"
                                Command="{Binding ConfirmResetCommand}">
                            Reset
                        </Button>

                    </StackPanel>

                </StackPanel>
            </materialDesign:Card>
        </materialDesign:DialogHost.DialogContent>

    </materialDesign:DialogHost>
</UserControl>
