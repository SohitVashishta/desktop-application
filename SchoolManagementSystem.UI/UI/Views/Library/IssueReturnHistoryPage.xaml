<UserControl x:Class="SchoolManagementSystem.UI.UI.Views.Library.IssueReturnHistoryPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="#ECEFF4">

    <Grid Margin="15">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ================= ERP HEADER BAR ================= -->
        <!--<Border Grid.Row="0"
                Background="#2C3E50"
                Height="40"
                CornerRadius="3">

            <TextBlock Text="Issue / Return History"
                       Foreground="White"
                       VerticalAlignment="Center"
                       Margin="15,0"
                       FontSize="14"
                       FontWeight="SemiBold"/>
        </Border>-->

        <!-- ================= FILTER STRIP ================= -->
        <Border Grid.Row="1"
        
        Margin="0,8,0,8"
        Padding="8">

            <Grid VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="250"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Search -->
                <TextBox Grid.Column="0"
                 Height="28"
                 FontSize="11"
                 Padding="6,2"
                 VerticalContentAlignment="Center"
                 Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" />

                <!-- Status -->
                <ComboBox Grid.Column="1"
                  Height="28"
                  Margin="10,0,0,0"
                  FontSize="11"
                  VerticalContentAlignment="Center"
                  ItemsSource="{Binding StatusList}"
                  SelectedItem="{Binding SelectedStatus}" />

                <!-- Issue Book Button -->
                <Button Grid.Column="2"
                Content="Issue Book"
                Height="28"
                Margin="10,0,0,0"
                FontSize="11"
                Background="#2E86C1"
                Foreground="White"
                Command="{Binding IssueBookCommand}" />

                <!-- Pending Fine -->
                <StackPanel Grid.Column="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center">

                    <TextBlock Text="Pending Fine:"
                       FontSize="11"
                       Margin="0,0,5,0"
                       VerticalAlignment="Center"/>

                    <TextBlock Text="{Binding PendingFine, StringFormat=₹{0}}"
                       FontSize="12"
                       FontWeight="SemiBold"
                       Foreground="#C0392B"
                       VerticalAlignment="Center"/>
                </StackPanel>

            </Grid>
        </Border>


        <!-- ================= ERP DATAGRID ================= -->
        <Border Grid.Row="2"
                >

            <DataGrid ItemsSource="{Binding Transactions}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      RowHeight="28"
                      FontSize="11"
                      HeadersVisibility="Column"
                      GridLinesVisibility="All"
                      AlternatingRowBackground="#F8F9FB" VerticalContentAlignment="Center"
CanUserResizeColumns="True"
CanUserSortColumns="True">
                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <Setter Property="VerticalContentAlignment" Value="Center"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    </Style>
                </DataGrid.CellStyle>

                <!-- HEADER STYLE -->
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="FontWeight" Value="SemiBold"/>
                        <Setter Property="Background" Value="#F1F3F6"/>
                        <Setter Property="Height" Value="30"/>
                        <Setter Property="HorizontalContentAlignment" Value="Center"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>

                <!-- OVERDUE STYLE -->
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsOverdue}" Value="True">
                                <Setter Property="Background" Value="#FDEDEC"/>
                                <Setter Property="Foreground" Value="#922B21"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>

                <DataGrid.Columns>

                    <DataGridTextColumn Header="Student"
                                        Binding="{Binding StudentName}"
                                        Width="*"/>
                    <DataGridTextColumn Header="Book Name"
                     Binding="{Binding BookName}"
                     Width="*"/>

                    <DataGridTextColumn Header="Issue Date"
                                        Binding="{Binding IssueDate, StringFormat=dd-MM-yyyy}"
                                        Width="110"/>

                    <DataGridTextColumn Header="Due Date"
                                        Binding="{Binding DueDate, StringFormat=dd-MM-yyyy}"
                                        Width="110"/>

                    <DataGridTextColumn Header="Return Date"
                                        Binding="{Binding ReturnDate, StringFormat=dd-MM-yyyy}"
                                        Width="110"/>

                    <DataGridTextColumn Header="Fine"
                                        Binding="{Binding FineAmount}"
                                        Width="80"/>

                    <DataGridTextColumn Header="Status"
                                        Binding="{Binding Status}"
                                        Width="90"/>

                    <DataGridTemplateColumn Header="Action" Width="90">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Return"
                                        Height="22"
                                        FontSize="10"
                                        Padding="5,0"
                                        Background="#27AE60"
                                        Foreground="White"
                                        Command="{Binding DataContext.ReturnBookCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                </DataGrid.Columns>

            </DataGrid>
        </Border>

        <!-- ================= ERP PAGINATION ================= -->
        <StackPanel Grid.Row="3"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,8,0,0">

            <Button Content="◀ Previous"
                    Height="26"
                    FontSize="11"
                    Margin="5"
                    Command="{Binding PreviousPageCommand}" />

            <TextBlock Text="{Binding CurrentPage}"
                       VerticalAlignment="Center"
                       FontSize="11"
                       FontWeight="Bold"
                       Margin="10,0"/>

            <Button Content="Next ▶"
                    Height="26"
                    FontSize="11"
                    Margin="5"
                    Command="{Binding NextPageCommand}" />

        </StackPanel>

    </Grid>
</UserControl>
